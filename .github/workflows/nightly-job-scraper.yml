name: Nightly Job Scraper

on:
  schedule:
    # Run at 2 AM UTC every day
    - cron: '0 2 * * *'
  workflow_dispatch:  # Allow manual triggering

jobs:
  run-job-scraper:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install
      
      - name: Run Step 1 - Job Index Scraper
        run: |
          echo "Starting Step 1: Scraping job listings from JobIndex"
          python src/[STEP1]jobindex_scraper.py
          echo "Step 1 completed"
      
      - name: Run Step 2 - Get HTML Text
        run: |
          echo "Starting Step 2: Extracting HTML content from job listings"
          python src/[STEP2]get_html_text.py
          echo "Step 2 completed"
      
      - name: Run Step 3 - Generate Embeddings
        run: |
          echo "Starting Step 3: Generating embeddings for job listings"
          python src/[STEP3]generate_embeddings.py
          echo "Step 3 completed"
      
      - name: Job Complete
        run: echo "Nightly job scraper workflow completed successfully"